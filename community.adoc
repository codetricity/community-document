= http://theta360developers.github.io/[Unofficial Guides]
:icons: font
:toc: right
:toclevels: 1
:toc-title: Contents
:sectnums:

++++
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-73311422-3', 'auto');
ga('send', 'pageview');
</script>
++++

image::img/media_guide_logo2.png[THETA DEVELOPERS UNOFFICIAL MEDIA GUIDE]

Send comments and corrections to <ricohtheta360@oppkey.com>

This is an unofficial, community-generated guide for developing applications
that use 360 media from RICOH THETA cameras.
This is not authorized by RICOH and is based on publicly available information.

==  Resources
=== Official Information

* https://developers.theta360.com/en/docs/v2/api_reference/[RICOH THETA API v2],
compliant with
https://developers.google.com/streetview/open-spherical-camera/[Open Spherical Camera API version 1.0] from Google.
* https://developers.theta360.com/en/forums/[THETA Developers Official Forum]
* https://developers.theta360.com/en/docs/sdk/[Official SDK]
* https://theta360.com/en/support/download/[Windows, Mac, iOS, Android apps]

=== Unofficial Information
* https://github.com/theta360developers[GitHub listing of community repositories] - libraries and code examples from the community
* http://theta360developers.github.io/blog/[Blog for developers] - How-To articles from the community
* Guides
** http://codetricity.github.io/theta-s/index.html[Unofficial API Guide] - Use the RICOH
THETA S API, a HTTP API based on Open Spherical Camera (OSC) specifications.
Beginners should start here. Web browser using advanced HTTP clients,
command line curl, Python. Planned examples for JavaScript and other languages.
** http://theta360developers.github.io/community-document/community.html[Unofficial Media Guide] -
360 degree media management. Streaming video, equirectangular conversion, stitching


== 360 Video Formats

Video is stored on the camera in dual fish-eye mode.

The dual-fisheye MP4 file has an image size of 1920x1080 or 1280x720.

The official RICOH desktop app will convert this to equirectangular
mode. By default, the program will take your file name and add `_er` to it.
The file is saved in the same directory that the original video file was in.

Both the input and output are `.mp4` format videos.

image::img/video/dual_fish_eye.png[role="thumb" title="dual fish eye video format"]

The program will convert it to equirectangular. Note that there is
a minor color shading difference on the right side of the screen grab.
The camera has two lenses. Each lens captures and saves one sphere.
The software on the computer stitches the image together. The RICOH
app adds the meta video meta data in for you.

NOTE: if you use something like Adobe Premiere Pro to edit your videos, you will need to inject the meta data again

image::img/video/equirectangular_video.png[role="thumb" title="equirectangular video format"]

You can now load the video up to YouTube to your normal channel.  YouTube
will grab the meta data and add the 360 degree video controls automatically.
This is cool!

image::img/video/youtube_360.png[role="thumb" title="YouTube 360 video"]

https://youtu.be/MXX_JjQdtmE[Try it out].

NOTE: I've successfully tested the YouTube viewer on Windows and Mac with different browsers and on Linux with FireFox. It does not appear to work on Linux with Chrome. This is a limitation of YouTube.  :-((


== Video Live Streaming
The THETA S can stream video when connected to a USB or HDMI cable.
The output is in dual fish-eye mode (two spheres). To make the video
usable in a web browser or with external services such as YouTube,
you'll need to convert the video into equirectangular mode. Note that
as of February 10, 2016, YouTube does not support live streaming
 of 360 video with navigation.

To view a video with 360 degree navigation, you'll need to stitch it into
equirectangular data.

.Table THETA S Live Streaming
|===
|Type |Format |Camera Mode |Size |Frame Rate| Connection

|Live View
|Equirectangular in MotionJPEG
|Image Only
|640x320
|10fps
|WiFi

|USB Live Streaming of dual-fisheye
|Dual-fisheye in MotionJPEG
|live streaming
|1280x720
|15fps
|USB isochronous transfer

|HDMI live streaming of dual-fisheye
|Dual-fisheye in uncompressed YCbCr
|live streaming
|1920x1080, 1280x720, 720x480
|30fps
|HDMI

|USB live streaming of equirectangular
|Equirectangular
|live streaming
|
|
|USB (not publicly available as of 2/10)
|===

In preparation for a hackathon, we helped RICOH test the pre-release
version of the upcoming USB live streaming driver that outputs equirectangular
video.

image::img/livestreaming/streaming.jpg[role="thumb" title="USB live streaming with equirectangular"]

The USB driver appears as a web cam to applications running a Mac or PC.
In the example above, the video is shown in QuickTime. A video clip
that shows the output of the
https://youtu.be/A8Al7U2ZeF0?list=PLxvyAnoL-vu5AF0A_l2wIr9vkMBRjHEgm[THETA S USB live streaming is available on YouTube].


Unless you are using
https://developers.theta360.com/en/docs/v2/api_reference/commands/camera._get_live_preview.html[`camera._getLivePreview`]
in image mode to display a low-resolution live view
with low frame rate, the first step is to get the camera into
live streaming mode

image::img/video/thetas_livestreaming.jpg[role="thumb" title="Set Live streaming video mode on RICOH THETA S"]


=== For USB

. Press “mode button” - keep pressing - and press “power button” -> camera goes to the LiveVideoStreamig mode.
.  Connect a usb cable with S and laptop (MAC or PC).
. The THETA S can be used as a web cam. You can use web cam software such as
Skype to see live video streaming with the THETA S.

image::img/video/usb_live_streaming.png[role="thumb" title="Live video streaming from RICOH THETA S to a computer monitor with USB 3"]


=== For HDMI

. Press “mode button” - keep pressing - and press “power button” -> camera goes to LiveVideoStreamig mode.
. connect a hdmi cable with S and a monitor.
. S could be a output video device. The monitor shows the S’s live video streaming .


[[img-hdmi_live_streaming]]
image::img/video/hdmi_live_streaming.jpg[role="thumb" title="Live video streaming from RICOH THETA S to a TV with HDMI"]

=== API Testing

`POST` to `http://192.168.1.1/osc/commands/execute`

  {"name": "camera.getOptions",
      "parameters":
  	{
      	"sessionId": "SID_0003",
      	"optionNames": [
              "captureMode"
      	]
  	}
  }

NOTE: Remember to set your sessionId correctly

The response:

  {
    "name": "camera.getOptions",
    "state": "done",
    "results":{
      "options":{
        "iso": 0,
        "isoSupport":[],
        "captureMode": "_liveStreaming"
        }
      }
  }

=== Example with Processor Language
Community Contribution from Sunao Hashimoto, kougaku on GitHub. Full
sample source code is available.

* https://github.com/theta360developers/THETA-S-LiveViewer-P5[THETA S LiveViewer P5]

image::img/theta_s_live_viewer.gif[title="Live viewer for THETA S"]

The example above is built with https://processing.org/[Processing].

Additional information is on his http://d.hatena.ne.jp/kougaku-navi/[blog post in Japanese].

image::img/kougaku_stitching_english.png[title="dual fish-eye video stitching"]


=== Examples with Unity
Nora, @steroarts, released a shader pack to convert THETA 360 degree
media into equirectangular format in real time.

* https://dl.dropboxusercontent.com/u/7131835/Programs/ThetaS_LiveView_Sample.unitypackage[Shader Pack]

The developer below, Goroman, was able to get reasonable 360 video live streaming in equirectangular mode
after an hour of work back in September, 2015. Additional information in
http://tips.hecomi.com/entry/2015/10/11/211456[Japanese is here].

image::img/goro_man.png[title="equirectangular video without stitching" link="https://youtu.be/edWrhCYIS5Q"]

Once the video is streamed in equirectangular mode, viewers such as VR Gear
or a browser using YouTube 360 can stitch the image.

==== Community Articles About 360 Display in Unity

* http://horriblepain.com/2015/05/360-display-in-unity-w-blender/[Horrible Pain's notes on 360 display in Unity w/Blender]


== Image Viewers
The RICOH THETA S will will generate a equirectangular JPEG file of
5376x2688 or 2048x1024.

=== Example in Processor language
image::img/still_image_stitching_english.png[title="still image stitching"]

https://github.com/kougaku/PanoramaViewer[Source code available on GitHub].

=== Example in Javascript
image::img/akokubo_javascript_viewer.png[title="360 degree still image in Chrome web browser"]

* http://akokubo.github.io/ThetaViewer/demo1.html[Demo of 360 image in browser]
* https://github.com/theta360developers/ThetaViewer[Javascript source code]

== Linux
RICOH only supports Mac and Windows desktop. As many developers use
Linux, we've collected some information from the community to help
people with basic tasks.

Linux can be used to control the camera HTTP API. There are also a number of
scripts to get media from the camera.

If you want to use Linux to
download media from the THETA and view it on your Linux box,
you can use Wine for image viewing using the
THETA Windows app or use a third-party application, Pano2VR.

Documentation below contributed by Svendus

SphericalViewer.exe opens and installs with Wine
It runs and you can view Spherical images, but videos are not converted.

Linux users can also import the files and use Pano2VR5.

* http://ggnome.com/pano2vr[PANO2VR]

  sudo apt-get install --no-install-recommends gnome-panel
  sudo gnome-desktop-item-edit /usr/share/applications/ --create-new

image::img/linux/new-app.png[]

image::img/linux/pano2vr-1.png[]

image::img/linux/pano2vr-2.png[]

image::img/linux/pano2vr-3.png[]

image::img/linux/pano2vr-4.png[]

== Command Line
* https://github.com/theta360developers/python-download-rossgoderer[Python script downloader]
from Ulrich Rossgoderer. Community.

== Programming Languages
The HTTP API of the THETA S can be accessed from almost any programming language.

* http://qiita.com/sandinist/items/9c3a77fdf262513ede3d[Article in Japanese] about using the RICOH THETA S API in shell, Ruby, Python, Swift, and C#.



== Proprietary Technical Information

=== Lens Parameter Information
The lens geometry for the THETA is based on equidistant projection.
The final projection
style for both videos and images is equirectangular projection.
RICOH does not make detailed lens parameter information available. This is
also known as lens distortion data. Developers often ask for this
information to improve stitching. It is proprietary and not available
as of December 2015. Stitching is still possible without this information.

=== Stitching Libraries
The RICOH THETA S processes still images inside of the camera. It
takes 8 seconds for the camera to be ready to take another still
image.

The videos are stored in dual-fisheye format (two spheres). The
official RICOH applications will convert this into equirectagular
format on either mobile devices or desktop computers. This format
can then be viewed locally or uploaded to YouTube, Facebook, or
other sites.

The source code and algorithms to perform this stitching
are not available to developers.

As of December 2015, there is no way to use the RICOH
libraries in live streaming mode.
